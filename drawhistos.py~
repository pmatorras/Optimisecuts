from ROOT import TCanvas, TPad, TFile, TPaveLabel, TPaveText
from ROOT import gROOT,gDirectory, TTree
from definebranches import hfilenm, defVectors
import os
hfile = TFile(hfilenm,"READ","Example");
bkgs = hfile.Get("bkgs");
gROOT.SetBatch(0)
c1 = TCanvas( 'c1', 'Dynamic Filling Example', 200,\
 10, 1600, 900 )
drawopt=''
samples={'T2tt':'hT2tt', 'ttbar':'httbar'}
xMin=-999
xMax=-999
yMax= 999
yMin= 0
doLogy=False
variables=["evid_", "maxSV_", "nSV_", "Dnjetstot_", "isSF_", \
           "btagW_", " bvetoW_", "MET_sumEt_", "MET_pt_", \
           "PV_x_", "PV_y_", "PV_z_", "PV_npvs_", "PV_chi2_",\
           "SV_eta_", "SV_phi_", "SV_pt_", "SV_mass_", \
           "SV_x_", "SV_y_", "SV_z_", "SV_chi2_", " mll_", \
           "mt2ll_", "nLepton_", "ptmiss_", "susyMstop_", "susyMLSP"]
bjets={'btag': 'btagW_', 'bveto':'bvetoW_'}
flavours={'df':'-1','sf':'1'}
for var in variables:
    for bjet in bjets:
        print "bjet", bjet
        for fl in flavours:
            print "flavour",fl
            for sample in samples:
                print "sample",sample
                tree=hfile.Get(sample)
                histo=var+sample+">>"+samples[sample]+'_'+fl
                flcond="isSF_"+sample+"=="+flavours[fl]
                bjetcond=bjets[bjet]+sample
                condition=bjetcond+'*('+flcond+')'
                print "condition", condition
                tree.Draw(histo, condition)
            hT2tt  = gDirectory.Get(samples["T2tt"]+'_'+fl);
            httbar = gDirectory.Get(samples["ttbar"]+'_'+fl)
            yMax=max(hT2tt.GetMaximum(),httbar.GetMaximum())
            xMin=min(hT2tt.GetXaxis().GetXmin(),httbar.GetXaxis().GetXmin())
            xMax= max(hT2tt.GetXaxis().GetXmax(),httbar.GetXaxis().GetXmax())
            yMin=min(hT2tt.GetMinimum(),httbar.GetMinimum())
            print xMax
            hT2tt.GetYaxis().SetRangeUser(0.9*yMin,1.1*yMax)
            hT2tt.GetXaxis().SetRangeUser(0.9*xMin,1.1*xMax)
        
            hT2tt.SetLineColor(2)
            hT2tt.Draw('e')
            httbar.Draw("e same")

            histnm=var+bjet+fl+".png"
            print histnm
            c1.SaveAs(histnm)
            #os.system("display "+histnm+" ")

    
